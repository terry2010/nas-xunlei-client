<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ§åˆ¶æ </title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      height: 100vh;
      overflow: hidden;
    }
    
    .control-bar {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      background-color: #409eff;
      color: white;
      height: 100%;
    }
    
    .control-bar-title {
      font-size: 16px;
      font-weight: bold;
      margin-right: 20px;
    }
    
    .control-bar-buttons {
      display: flex;
      gap: 10px;
      flex: 1;
    }
    
    .control-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      background-color: white;
      color: #409eff;
      font-weight: 500;
      display: flex;
      align-items: center;
      transition: all 0.3s;
    }
    
    .control-btn:hover {
      background-color: #ecf5ff;
    }
    
    .control-btn-icon {
      margin-right: 5px;
    }
    
    .control-bar-status {
      margin-left: auto;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="control-bar">
    <div class="control-bar-title">NASè¿…é›·æ§åˆ¶å°</div>
    <div class="control-bar-buttons">
      <button id="open-folder-btn" class="control-btn">
        <span class="control-btn-icon">ğŸ“</span>æ‰“å¼€ä¸‹è½½ç›®å½•
      </button>
      <button id="refresh-btn" class="control-btn">
        <span class="control-btn-icon">ğŸ”„</span>åˆ·æ–°é¡µé¢
      </button>
      <button id="manual-login-btn" class="control-btn">
        <span class="control-btn-icon">ğŸ”‘</span>è½¬ä¸ºæ‰‹å·¥ç™»å½•
      </button>
      <button id="logout-btn" class="control-btn">
        <span class="control-btn-icon">ğŸ”’</span>æ³¨é”€
      </button>
      <button id="config-btn" class="control-btn">
        <span class="control-btn-icon">âš™ï¸</span>é…ç½®
      </button>
    </div>
    <div class="control-bar-status" id="status-text">å·²è¿æ¥</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // è·å–æŒ‰é’®å…ƒç´ 
      const openFolderBtn = document.getElementById('open-folder-btn');
      const refreshBtn = document.getElementById('refresh-btn');
      const manualLoginBtn = document.getElementById('manual-login-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const configBtn = document.getElementById('config-btn');
      const statusText = document.getElementById('status-text');
      
      // æ‰“å¼€ä¸‹è½½ç›®å½•
      openFolderBtn.addEventListener('click', async () => {
        if (window.electronAPI) {
          try {
            // è·å–é…ç½®ä¸­çš„ä¸‹è½½ç›®å½•è·¯å¾„
            const config = await window.electronAPI.getConfig();
            if (config.downloadPath) {
              window.electronAPI.openFolder(config.downloadPath);
              statusText.textContent = 'æ­£åœ¨æ‰“å¼€ä¸‹è½½ç›®å½•...';
              setTimeout(() => {
                statusText.textContent = 'å·²è¿æ¥';
              }, 2000);
            } else {
              statusText.textContent = 'é”™è¯¯: æœªé…ç½®ä¸‹è½½ç›®å½•';
              setTimeout(() => {
                statusText.textContent = 'å·²è¿æ¥';
              }, 2000);
            }
          } catch (error) {
            console.error('è·å–é…ç½®å¤±è´¥:', error);
            statusText.textContent = 'é”™è¯¯: è·å–é…ç½®å¤±è´¥';
            setTimeout(() => {
              statusText.textContent = 'å·²è¿æ¥';
            }, 2000);
          }
        }
      });
      
      // åˆ·æ–°é¡µé¢
      refreshBtn.addEventListener('click', () => {
        if (window.electronAPI) {
          window.electronAPI.refreshNasPage();
          statusText.textContent = 'æ­£åœ¨åˆ·æ–°é¡µé¢...';
          setTimeout(() => {
            statusText.textContent = 'å·²è¿æ¥';
          }, 2000);
        }
      });
      
      // æ³¨é”€
      logoutBtn.addEventListener('click', () => {
        if (window.electronAPI) {
          window.electronAPI.clearCookies();
          statusText.textContent = 'æ­£åœ¨æ³¨é”€...';
          setTimeout(() => {
            statusText.textContent = 'å·²è¿æ¥';
          }, 2000);
        }
      });
      
      // è½¬ä¸ºæ‰‹å·¥ç™»å½•
      manualLoginBtn.addEventListener('click', () => {
        if (window.electronAPI) {
          window.electronAPI.stopAutoLogin();
          statusText.textContent = 'å·²åˆ‡æ¢åˆ°æ‰‹å·¥ç™»å½•æ¨¡å¼';
          manualLoginBtn.style.display = 'inline-block';
          setTimeout(() => {
            statusText.textContent = 'å·²è¿æ¥';
          }, 2000);
        }
      });
      
      // æ‰“å¼€é…ç½®é¡µé¢
      configBtn.addEventListener('click', () => {
        if (window.electronAPI) {
          window.electronAPI.showConfig();
          statusText.textContent = 'æ­£åœ¨æ‰“å¼€é…ç½®é¡µé¢...';
          setTimeout(() => {
            statusText.textContent = 'å·²è¿æ¥';
          }, 2000);
        }
      });
      
      // ç›‘å¬ä¸‹è½½é“¾æ¥å¤„ç†
      if (window.electronAPI) {
        window.electronAPI.onDownloadUrlReceived((url) => {
          statusText.textContent = `æ­£åœ¨å¤„ç†ä¸‹è½½é“¾æ¥: ${url.substring(0, 20)}...`;
          setTimeout(() => {
            statusText.textContent = 'å·²è¿æ¥';
          }, 3000);
        });
      }
      
      // ç›‘å¬è‡ªåŠ¨ç™»å½•çŠ¶æ€
      window.electronAPI.onAutoLoginStateChange((state) => {
        if (state === 'auto-login') {
          manualLoginBtn.style.display = 'inline-block';
        } else if (state === 'login-completed') {
          manualLoginBtn.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
