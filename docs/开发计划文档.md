# 群辉NAS迅雷客户端开发计划文档

## 1. 项目概述

### 1.1 项目背景
群辉NAS系统提供了迅雷网页应用，用户可以通过访问NAS的URL操作迅雷应用，查看下载列表和新建下载任务。本项目旨在开发一个桌面客户端，提供更便捷的方式来控制群辉NAS迅雷应用。

### 1.2 技术栈
项目使用 
- 前端：Vue 3.0 + JavaScript + Element Plus
- 桌面应用框架：Electron
- 后端服务：Node.js
- 支持平台：Windows、macOS

### 1.3 项目目标
1. 提供简洁易用的桌面客户端，方便用户管理NAS迅雷下载任务
2. 实现自动登录、一键打开下载目录等便捷功能
3. 支持迅雷/BT下载链接的系统级拦截与处理
4. 确保跨平台兼容性（Windows和macOS）

## 2. 项目结构

### 2.1 目录结构
```
nas-xunlei-client/
├── docs/                 # 文档目录
├── src/                  # 源代码目录
│   ├── assets/           # 静态资源
│   ├── components/       # Vue组件
│   ├── utils/            # 工具函数
│   ├── views/            # 页面视图
│   ├── App.vue           # 根组件
│   ├── main.js           # Vue入口文件
│   ├── index.html        # 配置页面
│   ├── main-view.html    # 主视图页面
│   ├── control-bar.html  # 控制栏页面
│   └── blank.html        # 空白页面
├── src-electron/         # Electron相关代码
│   ├── main.js           # 主进程
│   └── preload.js        # 预加载脚本
├── package.json          # 项目配置
└── vite.config.js        # Vite配置
```

### 2.2 技术架构
- **单窗口双WebView结构**：上部WebView显示控制栏，下部WebView加载NAS页面
- **主进程与渲染进程通信**：通过IPC机制实现
- **配置存储**：使用electron-store实现加密存储
- **网络请求**：使用axios处理HTTP请求
- **协议处理**：注册系统级URL协议处理器（thunder://、magnet:）

## 3. 当前开发进度

### 3.1 已完成功能
- [x] 基础框架搭建
  - [x] 创建Electron项目基础结构
  - [x] 配置Vue 3.0开发环境
  - [x] 实现主进程与渲染进程通信机制
  - [x] 设计并实现双WebView结构
- [x] 配置管理功能
  - [x] 实现配置存储模块（使用electron-store）
  - [x] 开发配置界面（设置NAS地址、下载目录等）
  - [x] 实现配置测试连接功能
  - [x] 完成配置加密存储
- [x] 基础WebView与NAS交互
  - [x] 实现WebView加载NAS页面
  - [x] 开发页面导航控制功能（刷新、返回等）
  - [x] 实现登录页面检测
- [x] 部分迅雷应用增强功能
  - [x] 实现"打开下载目录"按钮注入
  - [x] 注册系统级URL协议处理器
  - [x] 实现客户端自动启动逻辑

### 3.2 进行中功能
- [ ] 自动登录功能完善
  - [x] 用户名填充与提交
  - [x] 密码填充与提交
  - [ ] 优化登录状态检测逻辑
  - [ ] 增强登录失败处理机制
- [ ] 下载链接处理功能完善
  - [x] 基础下载链接拦截
  - [ ] 优化新建任务自动填充功能
  - [ ] 测试各类下载链接格式兼容性

### 3.3 待开发功能
- [ ] 用户界面优化
  - [ ] 改进加载状态显示
  - [ ] 优化错误提示机制
  - [ ] 实现深色/浅色主题支持
  - [ ] 增强响应式布局适配
- [ ] 安全性增强
  - [ ] 完善密码加密存储机制
  - [ ] 增强HTTPS证书验证
  - [ ] 优化安全日志记录

## 4. 后续开发计划

### 4.1 短期计划（2周内）
1. **完善自动登录功能**（预计3天）
   - 优化登录状态检测逻辑
   - 增强登录失败处理机制
   - 支持更多群辉NAS版本的登录页面结构
   - 添加登录超时检测和重试机制

2. **优化下载链接处理功能**（预计2天）
   - 完善新建任务自动填充功能
   - 测试各类下载链接格式的兼容性（thunder://、magnet:、http/https等）
   - 优化下载链接解析逻辑

3. **改进用户界面**（预计3天）
   - 优化加载状态显示，添加进度指示
   - 改进错误提示机制，提供更友好的错误信息
   - 实现状态栏信息更新
   - 优化控制栏布局和样式

### 4.2 中期计划（1个月内）
1. **增强安全性**（预计2天）
   - 完善密码加密存储机制
   - 增强HTTPS证书验证
   - 优化安全日志记录，避免敏感信息泄露

2. **性能优化**（预计3天）
   - 优化WebView资源管理
   - 减少不必要的事件监听器
   - 实现懒加载机制
   - 优化启动速度

3. **测试与修复**（预计5天）
   - 进行全面的功能测试
   - 修复发现的问题
   - 进行跨平台兼容性测试（Windows和macOS）
   - 进行边缘情况测试（网络中断、NAS不可访问等）

4. **准备Beta版本发布**（预计2天）
   - 准备安装包和发布说明
   - 完善文档
   - 创建用户指南

### 4.3 长期计划（2-3个月）
1. **功能扩展**
   - 下载任务管理增强（查看进度、暂停/恢复等）
   - 批量添加下载任务
   - 下载完成通知
   - 下载速度图表显示

2. **用户体验提升**
   - 实现深色/浅色主题支持
   - 添加操作反馈动画
   - 优化响应式布局，适应不同屏幕尺寸
   - 实现自定义快捷键

3. **平台扩展**
   - 考虑添加Linux支持
   - 研究移动端配套应用可行性

## 5. 技术难点与解决方案

### 5.1 WebView注入脚本问题
**问题**：在某些情况下，WebView注入的JavaScript无法正确执行，导致自动登录和功能增强失效。

**解决方案**：
- 使用MutationObserver监听DOM变化，确保在正确时机执行脚本
- 实现重试机制，多次尝试注入脚本
- 使用预加载脚本（preload.js）提供更可靠的注入方式
- 添加详细日志，便于调试和问题定位

### 5.2 自动登录稳定性问题
**问题**：群辉NAS登录页面结构可能因版本不同而变化，导致自动登录失败。

**解决方案**：
- 实现多种选择器匹配策略，适应不同版本的页面结构
- 添加登录超时检测和重试机制
- 提供手动登录回退选项，确保用户体验
- 实现登录状态持久化，减少重复登录需求

### 5.3 跨平台兼容性问题
**问题**：Windows和macOS平台的文件路径和系统API差异导致兼容性问题。

**解决方案**：
- 使用Node.js的path模块处理路径，确保跨平台一致性
- 根据平台类型（process.platform）使用不同的系统API
- 实现平台特定的配置选项和功能适配
- 在两个平台上进行充分测试，确保功能正常

## 6. 测试计划

### 6.1 单元测试
- 配置组件测试：验证配置保存、加载和验证功能
- WebView交互测试：验证页面加载、导航和脚本注入功能
- 协议处理测试：验证下载链接拦截和处理功能

### 6.2 集成测试
- 自动登录流程测试：验证完整登录流程的稳定性
- 下载链接处理测试：验证各类下载链接的兼容性
- 跨平台兼容性测试：在Windows和macOS上验证功能一致性

### 6.3 用户体验测试
- 界面易用性测试：评估界面布局和交互设计
- 性能测试：评估启动速度、响应时间和资源占用
- 安全性测试：验证敏感信息处理和加密存储

## 7. 风险管理

### 7.1 技术风险
| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| NAS界面结构变更 | 中 | 高 | 实现更灵活的选择器和检测机制 |
| Electron安全更新 | 高 | 中 | 定期更新依赖，关注安全公告 |
| 跨平台兼容性问题 | 中 | 中 | 增加平台特定代码，全面测试 |

### 7.2 项目风险
| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 开发进度延迟 | 中 | 中 | 设置合理里程碑，优先实现核心功能 |
| 用户体验不符合预期 | 低 | 高 | 早期进行原型测试，收集用户反馈 |
| 跨平台兼容性问题 | 中 | 中 | 设计时考虑平台差异，增加平台特定代码 |

## 8. 未来迭代计划

### 8.1 功能扩展
- 下载任务管理增强（查看进度、暂停/恢复、优先级调整）
- 批量添加下载任务
- 下载完成通知
- 下载速度图表
- 定时下载任务

### 8.2 平台扩展
- 考虑添加Linux支持
- 开发移动端配套应用
- 支持更多NAS系统版本

### 8.3 集成增强
- 与其他NAS应用集成
- 支持更多下载协议
- 添加云同步功能
- 实现多NAS设备管理
